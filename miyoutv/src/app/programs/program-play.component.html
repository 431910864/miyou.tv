<!DOCTYPE html>
<!--
Copyright 2016-2018 Brazil Ltd.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<meta charset="UTF-8">
<ngx-loading-bar [includeSpinner]="loading" [includeBar]="loading"></ngx-loading-bar>
<div class="player view-content d-flex flex-column fit">
    <div class="view-content-header row align-items-center m-0 text-truncate bg-dark text-light">
        <div class="col-2 col-sm-1 p-0 text-left">
            <button class="btn bg-transparent" title="再生を終了" (click)="stop()">
                <img class="img-icon-md" src="assets/back.svg">
            </button>
        </div>
        <div class="col-10 px-0 py-2 text-center text-truncate">
            <span class="channel">{{info?.channelName}}</span>
            <span class="title">{{info?.fullTitle}}</span>
        </div>
    </div>
    <div class="view-content-body flex-fill position-relative">
        <div class="row fit m-0">
            <div class="col-12 flex-column h-100 p-0" [ngClass]="sidebarCollapsed ? ['d-flex'] : ['col-xl-8', 'col-lg-7', 'col-md-6', 'd-md-flex', 'd-none']" [contextMenu]="playerMenu">
                <div class="screen flex-fill position-relative overflow-hidden text-nowrap text-white font-weight-bold" (mousewheel)="onMouseWheel($event)">
                    <video-screen class="video-screen fit" (dblclick)="toggleFullscreen()"></video-screen>
                    <comment-screen class="comment-screen fit"></comment-screen>
                </div>
                <div class="player-control bg-dark text-light">
                    <controlbar [commentEnabled]="commentEnabled" [fullscreenEnabled]="isFullscreen" [sidebarEnabled]="!sidebarCollapsed" (commentToggle)="toggleComment()" (fullscreenToggle)="toggleFullscreen()" (sidebarToggle)="sidebarCollapsed = !sidebarCollapsed"></controlbar>
                    <seekbar [offset]="offset" [chapters]="chapters" [chartPoints]="chartPoints" [peaks]="peaks" [showPrevious]="true" [showNext]="true" (previous)="previous()" (next)="next()"></seekbar>
                </div>
                <context-menu #playerMenu>
                    <ng-template contextMenuItem (execute)="player.togglePause()">
                        <span class="fas fa-fw" [class.fa-pause]="player.playing" [class.fa-play]="!player.playing"></span> {{player.playing ? '一時停止' : '再生'}}
                    </ng-template>
                    <ng-template contextMenuItem (execute)="player.jumpBackward('11s')">
                        <span class="fas fa-fw fa-caret-left"></span> 10秒戻す
                    </ng-template>
                    <ng-template contextMenuItem (execute)="player.jumpForward('29s')">
                        <span class="fas fa-fw fa-caret-right"></span> 30秒進める
                    </ng-template>
                    <ng-template contextMenuItem [subMenu]="playerSpeedMenu">
                        <span class="fas fa-fw fa-bars invisible"></span> 再生速度
                    </ng-template>
                    <context-menu #playerSpeedMenu>
                        <ng-template contextMenuItem (execute)="player.speedUp()">
                            <span class="fas fa-fw fa-forward"></span> 速くする
                        </ng-template>
                        <ng-template contextMenuItem (execute)="player.normalSpeed()">
                            <span class="fas fa-fw fa-play"></span> 通常再生
                        </ng-template>
                        <ng-template contextMenuItem (execute)="player.speedDown()">
                            <span class="fas fa-fw fa-backward"></span> 遅くする
                        </ng-template>
                    </context-menu>
                    <ng-template contextMenuItem [subMenu]="playerAudioMenu">
                        <span class="fas fa-fw fa-bars invisible"></span> オーディオ
                    </ng-template>
                    <context-menu #playerAudioMenu>
                        <ng-template contextMenuItem (execute)="player.toggleAudioTrack()">
                            <span class="fas fa-fw fa-redo"></span> 音声切替
                        </ng-template>
                        <ng-template contextMenuItem (execute)="player.increaseVolume(5)">
                            <span class="fas fa-fw fa-volume-up"></span> 音量を上げる
                        </ng-template>
                        <ng-template contextMenuItem (execute)="player.decreaseVolume(5)">
                            <span class="fas fa-fw fa-volume-down"></span> 音量を下げる
                        </ng-template>
                        <ng-template contextMenuItem (execute)="player.toggleMute()">
                            <span class="fas fa-fw fa-check text-primary" [class.invisible]="!player.mute"></span> ミュート
                        </ng-template>
                    </context-menu>
                    <ng-template contextMenuItem [subMenu]="playerVideoMenu">
                        <span class="fas fa-fw fa-bars invisible"></span> ビデオ
                    </ng-template>
                    <context-menu #playerVideoMenu>
                        <ng-template contextMenuItem (execute)="toggleFullscreen()">
                            <span class="fas fa-fw fa-check text-primary" [class.invisible]="!isFullscreen"></span> 全画面表示
                        </ng-template>
                        <ng-template contextMenuItem (execute)="toggleAlwaysOnTop()">
                            <span class="fas fa-fw fa-check text-primary" [class.invisible]="!isAlwaysOnTop"></span> 常に前面に表示
                        </ng-template>
                    </context-menu>

                    <ng-template contextMenuItem [subMenu]="playerCommentMenu">
                        <span class="fas fa-fw fa-bars invisible"></span> コメント
                    </ng-template>
                    <context-menu #playerCommentMenu>
                        <ng-template contextMenuItem (execute)="toggleComment()">
                            <span class="fas fa-fw fa-check text-primary" [class.invisible]="!commentEnabled"></span> コメントを表示
                        </ng-template>
                        <ng-template contextMenuItem (execute)="commentDelay = commentDelay - 500">
                            <span class="fas fa-fw fa-chevron-left"></span> 早める
                        </ng-template>
                        <ng-template contextMenuItem (execute)="commentDelay = commentDelay + 500">
                            <span class="fas fa-fw fa-chevron-right"></span> 遅らせる
                        </ng-template>
                    </context-menu>
                    <ng-template contextMenuItem (execute)="previous()">
                        <span class="fas fa-fw fa-backward"></span> 前の番組へ
                    </ng-template>
                    <ng-template contextMenuItem (execute)="next()">
                        <span class="fas fa-fw fa-forward"></span> 次の番組へ
                    </ng-template>
                    <ng-template contextMenuItem (execute)="sidebarCollapsed = !sidebarCollapsed">
                        <span class="fas fa-fw fa-check text-primary" [class.invisible]="sidebarCollapsed"></span> サイドバーを表示
                    </ng-template>
                    <ng-template contextMenuItem (execute)="player.stop()">
                        <span class="fas fa-fw fa-stop"></span> 再生を終了
                    </ng-template>
                </context-menu>
            </div>
            <div class="sidebar col-12 col-md-6 col-lg-5 col-xl-4 h-100 p-0 bg-dark text-light" [collapse]="sidebarCollapsed" (collapsed)="onSidebarCollapsed()" (expanded)="onSidebarExpanded()">
                <button class="sidebar-close close text-light mr-2" (click)="sidebarCollapsed = true"><span class="fas fa-times-circle"></span></button>
                <tabset type="tabs" class="sidebar-tabset h-100">
                    <tab heading="コメント">
                        <comment-grid class="fit" (jump)="jump($event)"></comment-grid>
                    </tab>
                    <tab heading="情報">
                        <program-play-info [recordInfo]="info" [programs]="programs" [commentInfo]="commentInfo"></program-play-info>
                    </tab>
                    <tab heading="再生設定">
                        <player-config></player-config>
                        <comment-config></comment-config>
                    </tab>
                </tabset>
            </div>
        </div>
    </div>
</div>
